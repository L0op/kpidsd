kpidop.kpi
==========

DSD (Direct Stream Digital) 音源を DSD over PCM (DoP) 方式で再生するため
のKbMedia Player プラグインです。対応する拡張子は dsf, dff, wsd です。

KbMedia Player 2.51beta14 が必要です。beta15 以降のバージョンでは動作し
ません。ASIO/WASAPI サポートが必要なためこれ以前のバージョンでもおそらく
動作しません。

KbMedia Player のプラグイン仕様は PCM を前提として作られているため、DSD
を再生する上で制限事項がありますので、このファイルは最後まで目を通してく
ださい。


対応 DSD DAC
------------

DoP Version 1.0 以降をサポートする DSD DAC で動作します。本プラグインの
実装は Version 1.1 の仕様に従っています。

5.6MHz 以上のサンプルレートには PCM サンプルレートを上げる方法で対応しま
す。マーカ 0x06/0xf9 を使う方式には対応していません（デバイスを持ってい
ないので）。

ステレオ以上のチャンネル数には DAC が対応している必要がありますが、
KbMedia Player の構造上チャンネル構成を伝える方法が無いため、データの想
定通りのチャンネル配置では鳴らないことがあります。

Roland UA-M10 と FOSTEX HP-A4 (thanks KOH) で確認しています。


KbMedia Player の構成
---------------------

このプラグインが出力した DoP ストリームをビットパーフェクトを守ったまま
デバイスまで伝える必要があるため、常に内部 64bit float 演算をするように
なった 2.51beta15 以降の KbMedia Player では動作しません。

またビットパーフェクトを実現するためには、2.51beta12 前後で実装された 
ASIO/WASAPI サポートが必要です。waveOut/DirectSound では動作しません。

開発及び動作確認は 2.51beta14 で行っています。


デバイス設定
------------

お使いのデバイスに合わせて、KbMedia Player の「デバイス設定」ダイアログ
で以下の項目について設定を行ってください。

・デバイスインタフェース：ASIO か WASAPI を選択。両方使えるデバイスもあ
るし、どちらかでないと使えないデバイスもあるらしい。

・プラグインへの出力ビット数要求：24bit INT か 32bit INT を選択。どちら
が使えるかはデバイスによって異なる。プラグインは両方に対応する。

・デバイスへの出力ビット数：32bit INT と 24bit INT だけをチェック、これ
ら以外は外す。

デバイスによって動作する組み合わせは変わるようですので、試行錯誤する必要
があるかもしれません。

ASIO4ALL 経由では使えないようです。ASIO サポートのないデバイスでは 
WASAPI をおすすめします。


サポートしない機能
------------------

以下の機能はオフにしてください。これらはプラグイン出力を加工するため、デ
バイスが DoP ストリームとして認識しなくなります。

・ボリューム→100% に戻す
・エコー
・ピッチスケール・テンポチェンジ
・クロスフェード
・リプレイゲイン

フェードアウトはそれを実行した瞬間から DoP ストリームでなくなるため、ノ
イズになったり音が出なくなります。

スペアナは DoP ストリームを無理やり分析しようとするため、常に低域がちょ
っと動くだけになります。

このプラグインで再生中のとき、「曲の長さ」の PCM パラメータは
  176400Hz（2.8224MHz のとき）または 352800Hz（5.6448MHz のとき）
  24bit または 32bit（プラグインへの出力ビット数要求に対応）
  mono または stereo
のように表示されます。


対応ファイルフォーマット
------------------------

以下のファイルフォーマットとバージョンに対応します。

・ソニー DSF v1.01
・フィリップス DSDIFF v1.5
・1bit オーディオコンソーシアム WSD v1.1

DSDIFF フォーマットにおける DST (Direct Stream Transfer) コーデックは 
XXX です。


KORG AudioGate v3.0.2 で生成した DSF/DSDIFF/WSD での動作を確認しています。

http://www.2l.no/hires/ でダウンロードできる DSDIFF ファイルで動作を確認
しています。

e-onkyo music で購入した DSF ファイルで動作を確認しています。

1bit オーディオコンソーシアム公式サイトの WSD ファイルで確認しています。


対応 OS
-------

64bit ファイル API を使用するため、Windows 2000 以降が必要です。リンカー
の設定上は Windows XP 以降に対応すると設定してビルドしていますが、
Windows 7 / 8.1 / 10 Preview 以外では確認していません。


シークについて
--------------

DSD DAC の機種によってはシーク時にプチノイズが乗ることがあります。
KbMedia Player はシーク中にデータが途切れる（PCM としては正しいが、DoP 
としては無音データを流すべき）ため、これを回避する手段はありません。


タグ情報について
----------------

DSF の ID3v2 タグには taglib ライブラリで対応します。ID3v2 のフレームと 
KbMedia Player タグ情報との対応は以下のとおりです。

TIT2 => タイトル
TPE1 => アーティスト
TALB => アルバム
TCON => ジャンル
TDRC => 年
COMM => コメント
TRCK => トラック番号

DSDIFF では、Edited Master Information チャンクにある DITI と DIAR チャ
ンクが、それぞれタイトルとアーティストに対応します。

DSDIFF の仕様に文字コードの規定がないので、これらが漢字を含むときはタグ
情報自体が記録されていないことがあります。もしあれば本プラグインとしては 
Shift_JIS として解釈します。

WSD では、タイトル、アーティスト、アルバム、ジャンル、コメント、日時に対
応します。WSD v1.1 の仕様には文字コードの規定がないので、これらが漢字を
含むときはタグ情報自体が記録されていないことがあります。もしあれば本プラ
グインとしては Shift_JIS として解釈します。


ライセンス
----------

kpidop.kpi - DSD over PCM plugin for KbMedia Player
 Copyright (c) 2015, Autch.net.

taglib Audio Meta-Data Library
 Copyright (C) 2002 - 2008 by Scott Wheeler, et al.

kpidop.kpi は ID3v2 タグ対応のために taglib ライブラリをリンクしています
（zlib は含んでいません）。taglib ライブラリは LGPL 2.1 と MPL 1.1 のデ
ュアルライセンスです。

LGPL: http://www.gnu.org/licenses/lgpl.html
MPL: http://www.mozilla.org/MPL/MPL-1.1.html

taglib ライブラリは以下のアドレスで入手できます。
http://taglib.github.io/

kpidop.kpi 自体は MIT ライセンスで配布されます。COPYING ファイルをご覧く
ださい。


----
Autch
autch@autch.net
http://github.com/autch
http://www.autch.net/
